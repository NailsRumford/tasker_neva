{% extends 'base.html' %}
{% load thumbnail %}
{% load user_filters %}
{% block content %}
<div class = 'container mt-2 pt-2 pb-3 border border-dark'>
  <div class="d-flex">
    <div class="flex-grow-1">
      <div class="accordion" id="accordionFireAlarmObjectHeader">
        <div class="accordion-item">
          <div id="collapseFoto" class="accordion-collapse collapse show" aria-labelledby="headingFoto" data-bs-parent="#accordionFireAlarmObjectHeader">
              {% if fire_alarm_object.photo %}
                {% thumbnail fire_alarm_object.photo "240x240" crop="center" upscale=True as im %}
                  <a href="{{ fire_alarm_object.photo.url }}"><img class="img" src="{{ im.url }}"></a>
                {% endthumbnail %}
              {% endif %}
          </div>
        </div>
        <div class="accordion-item">
          <div id="collapseMap" class="accordion-collapse collapse" aria-labelledby="headingMap" data-bs-parent="#accordionFireAlarmObjectHeader">
              {% include 'technicians/includes/map_fire_alarm_object.html' %}
          </div>
        </div>
      </div>
    </div>
    <div class="btn-group-vertical" role="group" aria-label="Вертикальная группа кнопок">
      <a type="button" class="btn btn-outline-dark border-0" href='http://workspace-neva.online/ru/%D0%9F%D0%BE%D0%B6%D0%B0%D1%80%D0%BD%D0%B0%D1%8F_%D1%81%D0%B8%D0%B3%D0%BD%D0%B0%D0%BB%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F/%D0%9E%D0%B1%D1%81%D0%BB%D1%83%D0%B6%D0%B8%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D0%BF%D0%BE%D0%B6%D0%B0%D1%80%D0%BD%D0%BE%D0%B9_%D1%81%D0%B8%D0%B3%D0%BD%D0%B0%D0%BB%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D0%B8'>
        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-question-circle" viewBox="0 0 16 16">
          <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"></path>
          <path d="M5.255 5.786a.237.237 0 0 0 .241.247h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286zm1.557 5.763c0 .533.425.927 1.01.927.609 0 1.028-.394 1.028-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94z"></path>
        </svg>
      </a>
      <button class="btn btn-outline-dark border-0" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFoto" aria-expanded="true" aria-controls="collapseFoto">
        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-camera" viewBox="0 0 16 16">
          <path d="M15 12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1h1.172a3 3 0 0 0 2.12-.879l.83-.828A1 1 0 0 1 6.827 3h2.344a1 1 0 0 1 .707.293l.828.828A3 3 0 0 0 12.828 5H14a1 1 0 0 1 1 1v6zM2 4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2h-1.172a2 2 0 0 1-1.414-.586l-.828-.828A2 2 0 0 0 9.172 2H6.828a2 2 0 0 0-1.414.586l-.828.828A2 2 0 0 1 3.172 4H2z"></path>
          <path d="M8 11a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5zm0 1a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7zM3 6.5a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0z"></path>
        </svg>
      </button>
      <button class="btn btn-outline-dark border-0 collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseMap" aria-expanded="false" aria-controls="collapseMap">
        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-map" viewBox="0 0 16 16">
          <path fill-rule="evenodd" d="M15.817.113A.5.5 0 0 1 16 .5v14a.5.5 0 0 1-.402.49l-5 1a.502.502 0 0 1-.196 0L5.5 15.01l-4.902.98A.5.5 0 0 1 0 15.5v-14a.5.5 0 0 1 .402-.49l5-1a.5.5 0 0 1 .196 0L10.5.99l4.902-.98a.5.5 0 0 1 .415.103zM10 1.91l-4-.8v12.98l4 .8V1.91zm1 12.98 4-.8V1.11l-4 .8v12.98zm-6-.8V1.11l-4 .8v12.98l4-.8z"></path>
        </svg>
      </button>
      <a type="button" class="btn btn-outline-dark border-0" href='{{navigator_link}}'>
        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-cursor" viewBox="0 0 16 16">
          <path d="M14.082 2.182a.5.5 0 0 1 .103.557L8.528 15.467a.5.5 0 0 1-.917-.007L5.57 10.694.803 8.652a.5.5 0 0 1-.006-.916l12.728-5.657a.5.5 0 0 1 .556.103zM2.25 8.184l3.897 1.67a.5.5 0 0 1 .262.263l1.67 3.897L12.743 3.52 2.25 8.184z"></path>
        </svg>
      </a>
      <button id="copy-button" onclick="copyToClipboard()" type="button" class="btn btn-outline-dark border-0">
        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-geo-alt" viewBox="0 0 16 16">
          <path d="M12.166 8.94c-.524 1.062-1.234 2.12-1.96 3.07A31.493 31.493 0 0 1 8 14.58a31.481 31.481 0 0 1-2.206-2.57c-.726-.95-1.436-2.008-1.96-3.07C3.304 7.867 3 6.862 3 6a5 5 0 0 1 10 0c0 .862-.305 1.867-.834 2.94zM8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10z"></path>
          <path d="M8 8a2 2 0 1 1 0-4 2 2 0 0 1 0 4zm0 1a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"></path>
        </svg>
      </button>
    </div>
  </div>
  <div id="post-shortlink" hidden>{{fire_alarm_object_geopoint_v2}}</div>


<script>
function copyToClipboard() {
  var element = document.getElementById("post-shortlink");
  var text = element.innerText;
  var tempInput = document.createElement("input");
  tempInput.value = text;
  document.body.appendChild(tempInput);
  tempInput.select();
  document.execCommand("copy");
  document.body.removeChild(tempInput);
  alert("Скопировано в буфер обмена: " + text);
}
</script>
  <div class="btn-group mt-2 mb-2" role="group" aria-label="Basic outlined example">
    <h2 class="accordion-header" id="flush-headingCard">
      <button class="btn btn-outline-dark " type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseCard" aria-expanded="true" aria-controls="flush-collapseCard">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-card-Заголовок" viewBox="0 0 16 16">
          <path d="M14.5 3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-13a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h13zm-13-1A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h13a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-13z"></path>
          <path d="M3 8.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5zm0-5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5v-1z"></path>
        </svg>
        Карточка
      </button>
    </h2>
    <h2 class="accordion-header" id="flush-headingEquipment">
      <button class="btn btn-outline-dark  collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEquipment" aria-expanded="false" aria-controls="flush-collapseEquipment">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-motherboard" viewBox="0 0 16 16">
          <path d="M11.5 2a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 .5-.5Zm2 0a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 .5-.5Zm-10 8a.5.5 0 0 0 0 1h6a.5.5 0 0 0 0-1h-6Zm0 2a.5.5 0 0 0 0 1h6a.5.5 0 0 0 0-1h-6ZM5 3a1 1 0 0 0-1 1h-.5a.5.5 0 0 0 0 1H4v1h-.5a.5.5 0 0 0 0 1H4a1 1 0 0 0 1 1v.5a.5.5 0 0 0 1 0V8h1v.5a.5.5 0 0 0 1 0V8a1 1 0 0 0 1-1h.5a.5.5 0 0 0 0-1H9V5h.5a.5.5 0 0 0 0-1H9a1 1 0 0 0-1-1v-.5a.5.5 0 0 0-1 0V3H6v-.5a.5.5 0 0 0-1 0V3Zm0 1h3v3H5V4Zm6.5 7a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h2a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-2Z"></path>
          <path d="M1 2a2 2 0 0 1 2-2h11a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2v-2H.5a.5.5 0 0 1-.5-.5v-1A.5.5 0 0 1 .5 9H1V8H.5a.5.5 0 0 1-.5-.5v-1A.5.5 0 0 1 .5 6H1V5H.5a.5.5 0 0 1-.5-.5v-2A.5.5 0 0 1 .5 2H1Zm1 11a1 1 0 0 0 1 1h11a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H3a1 1 0 0 0-1 1v11Z"></path>
        </svg>
        Оборудование
      </button>
    </h2>
    <h2 class="accordion-header" id="flush-headingHistory">
      <button class="btn btn-outline-dark collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseHystory" aria-expanded="false" aria-controls="flush-collapseHystory">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clock-history" viewBox="0 0 16 16">
          <path d="M8.515 1.019A7 7 0 0 0 8 1V0a8 8 0 0 1 .589.022l-.074.997zm2.004.45a7.003 7.003 0 0 0-.985-.299l.219-.976c.383.086.76.2 1.126.342l-.36.933zm1.37.71a7.01 7.01 0 0 0-.439-.27l.493-.87a8.025 8.025 0 0 1 .979.654l-.615.789a6.996 6.996 0 0 0-.418-.302zm1.834 1.79a6.99 6.99 0 0 0-.653-.796l.724-.69c.27.285.52.59.747.91l-.818.576zm.744 1.352a7.08 7.08 0 0 0-.214-.468l.893-.45a7.976 7.976 0 0 1 .45 1.088l-.95.313a7.023 7.023 0 0 0-.179-.483zm.53 2.507a6.991 6.991 0 0 0-.1-1.025l.985-.17c.067.386.106.778.116 1.17l-1 .025zm-.131 1.538c.033-.17.06-.339.081-.51l.993.123a7.957 7.957 0 0 1-.23 1.155l-.964-.267c.046-.165.086-.332.12-.501zm-.952 2.379c.184-.29.346-.594.486-.908l.914.405c-.16.36-.345.706-.555 1.038l-.845-.535zm-.964 1.205c.122-.122.239-.248.35-.378l.758.653a8.073 8.073 0 0 1-.401.432l-.707-.707z"></path>
          <path d="M8 1a7 7 0 1 0 4.95 11.95l.707.707A8.001 8.001 0 1 1 8 0v1z"></path>
          <path d="M7.5 3a.5.5 0 0 1 .5.5v5.21l3.248 1.856a.5.5 0 0 1-.496.868l-3.5-2A.5.5 0 0 1 7 9V3.5a.5.5 0 0 1 .5-.5z"></path>
        </svg>
        История
      </button>
    </h2>
  </div>
  <div class='container mt-2'>
    <div class="accordion accordion-flush" id="accordionFireAlarmObjectBase">
      <div class="accordion-item">
        <div id="flush-collapseCard" class="accordion-collapse collapse show" aria-labelledby="flush-headingCard" data-bs-parent="#accordionFireAlarmObjectBase">
          <div class="accordion-body">
            <p class="card-text"><h4>{{ fire_alarm_object.name }}</h4></p>
            <p class="card-text"><h6>Адрес:</h6>{{ fire_alarm_object.address }} {% if fire_alarm_object.room_number %}помещение:{{fire_alarm_object.room_number}}{% endif %}</p>
            {% if fire_alarm_objectremote_number %}
              <p class="card-text"><h6>Пультовый номер:</h6> {{fire_alarm_object.remote_number}}
            {% endif %}
            {% if fire_alarm_object.contract_number or fire_alarm_object.contract_date %}
            <p class="card-text"><h6>Договор:</h6> {% if fire_alarm_object.contract_number %}{{fire_alarm_object.contract_number}}{% endif %} от {% if fire_alarm_object.contract_date %}{{fire_alarm_object.contract_date}}{% endif %}
            {% else %}
            {% endif %}
            <p class="card-text"><h6>Обслуживающая организация:</h6> {{ fire_alarm_object.service_organizations }}</p>
            <p class="card-text"><h6>Переодичность:</h6> {{ fire_alarm_object.frequency }}</p>
            <p class="card-text"><h6>Произвести обслуживания до:</h6> {{ fire_alarm_object.next_service_date }}</p>
          </div>
        </div>
      </div>
      <div class="accordion-item">
        <div id="flush-collapseEquipment" class="accordion-collapse collapse" aria-labelledby="flush-headingEquipment" data-bs-parent="#accordionFireAlarmObjectBase">
          <div class="accordion-body">
            <p class="card-text"><h6>Оборудование:</h6> тут будет отрисовываться оборудования объекта и как с ним взаимодействовать</p>
            <p class="card-text"><h6>Проект:</h6> тут проект и как с ним взаимодействовать</p>
          </div>
        </div>
      </div>
      <div class="accordion-item">
        <div id="flush-collapseHystory" class="accordion-collapse collapse" aria-labelledby="flush-headingHistory" data-bs-parent="#accordionFireAlarmObjectBase">
          <div class="accordion-body">
            {% if failed_services %}
              <p><h5>Проблемы на объекте:</h5></p>
              <div class="accordion" id="accordionFailedService">
                {% for failed_service in failed_services %}
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="heading{{failed_service.id}}">
                      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{failed_service.id}}" aria-expanded="true" aria-controls="collapse{{failed_service.id}}">
                        Обслуживание от:{{failed_service.service_date}}
                      </button>
                    </h2>
                    <div id="collapse{{failed_service.id}}" class="accordion-collapse collapse" aria-labelledby="heading{{failed_service.id}}" data-bs-parent="#accordionFailedService">
                      <div style="accordion-body">
                        <div style="container">
                          <p><h6>Техник: {{ failed_service.technician }}</h6></p>
                          <p>
                          {% if failed_service.comment %}
                            <p><h6>Комментарий: {{ failed_service.comment }}</h6></p>
                          {% endif %}
                        <div>
                        <div class="row align-items-center">
                          <div class="image-container">
                            <div class="col d-flex flex-column align-items-center">
                              {% if failed_servicephoto %}
                              {% thumbnail failed_service.photo "120x120" crop="center" upscale=True as im %}
                                <a href="{{ failed_service.photo.url }}"><img src="{{ im.url }}" alt="Фотография журнала техобслуживания ПС" width="120" height="120"></a>
                              {% endthumbnail %}
                              <p><h6>Фотография журнала техобслуживания ПС</h6></p>
                              {% endif %}
                            </div>
                          </div>
                        </div>
                      </div>  
                    </div>
                  </div>
                {% endfor %}
              </div>
            {% endif %}
            {% if fire_alarm_object_services %}
              <p><h5>Журнал теобслуживаний:</h5><p>
              <div class="accordion" id="accordionService">
                {% for fire_alarm_object_service in fire_alarm_object_services %}
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="heading{{fire_alarm_object_service.id}}">
                      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{fire_alarm_object_service.id}}" aria-expanded="true" aria-controls="collapse{{fire_alarm_object_service.id}}">
                        Обслуживание от:{{fire_alarm_object_service.service_date}}
                      </button>
                    </h2>
                    <div id="collapse{{fire_alarm_object_service.id}}" class="accordion-collapse collapse" aria-labelledby="heading{{fire_alarm_object_service.id}}" data-bs-parent="#accordionService">
                      <div style="accordion-body">
                        <div style="container">
                            <p><h6>Техник: {{ fire_alarm_object_service.technician }}</h6></p>
                            <p>
                            {% if fire_alarm_object_service.comment %}
                              <p><h6>Комментарий: {{ fire_alarm_object_service.comment }}</h6></p>
                            {% endif %}
                        </div>
                        <div style="container">
                          <div class="row align-items-center">
                            <div class="image-container">
                              <div class="col d-flex flex-column align-items-center">
                                {% if fire_alarm_object_service.service_journal_title_page_photo %}
                                  {% thumbnail fire_alarm_object_service.service_journal_title_page_photo "x120" crop="center" upscale=True as im %}
                                    <a href="{{ fire_alarm_object_service.service_journal_title_page_photo.url }}"><img src="{{ im.url }}" alt="Фотография журнала техобслуживания ПС" width="120" height="120"></a>
                                  {% endthumbnail %}
                                  <p><h6>Фотография обложки журнала техобслуживания ПС</h6></p>
                                {% endif %}
                              </div>
                            </div>
                            <div class="image-container">
                              <div class="col d-flex flex-column align-items-center">
                                {% if fire_alarm_object_service.service_journal_photo %}
                                  {% thumbnail fire_alarm_object_service.service_journal_photo "x120" crop="center" upscale=True as im %}
                                    <a href="{{ fire_alarm_object_service.service_journal_photo.url }}"><img src="{{ im.url }}" alt="Фотография журнала техобслуживания ПС" width="120" height="120"></a>
                                  {% endthumbnail %}
                                  <p><h6>Фотография журнала техобслуживания ПС</h6></p>
                                {% endif %}
                              </div>
                            </div>
                            <div class="image-container">
                              <div class="col d-flex flex-column align-items-center">
                                {% if fire_alarm_object_service.control_panel_photo %}
                                  {% thumbnail fire_alarm_object_service.control_panel_photo "x120" crop="center" upscale=True as im %}
                                    <a href="{{ fire_alarm_object_service.control_panel_photo.url }}"><img src="{{ im.url }}" alt="Фотография головного прибора ПС" width="120" height="120"></a>
                                  {% endthumbnail %}
                                  <p><h6>Фотография головного прибора ПС</h6></p>
                                {% endif %}
                              </div>
                            </div>
                          </div>
                        </div>
                        </div>
                      </div>  
                    </div>
                  </div>
                {% endfor %}
              </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="d-grid gap-3">
    <a href="{% url 'technicians:fire_alarm_object_service_create' fire_alarm_object.id %}" class="btn btn-success btn-sm">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-journal-check" viewBox="0 0 16 16">
        <path fill-rule="evenodd" d="M10.854 6.146a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 1 1 .708-.708L7.5 8.793l2.646-2.647a.5.5 0 0 1 .708 0z"></path>
        <path d="M3 0h10a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2v-1h1v1a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H3a1 1 0 0 0-1 1v1H1V2a2 2 0 0 1 2-2z"></path>
        <path d="M1 5v-.5a.5.5 0 0 1 1 0V5h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1H1zm0 3v-.5a.5.5 0 0 1 1 0V8h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1H1zm0 3v-.5a.5.5 0 0 1 1 0v.5h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1H1z"></path>
      </svg>
      Сделать обслуживать
    </a>
    <a href="{% url 'technicians:failed_service_create' fire_alarm_object.id %}" class="btn btn-danger btn-sm">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-journal-x" viewBox="0 0 16 16">
        <path fill-rule="evenodd" d="M6.146 6.146a.5.5 0 0 1 .708 0L8 7.293l1.146-1.147a.5.5 0 1 1 .708.708L8.707 8l1.147 1.146a.5.5 0 0 1-.708.708L8 8.707 6.854 9.854a.5.5 0 0 1-.708-.708L7.293 8 6.146 6.854a.5.5 0 0 1 0-.708z"></path>
        <path d="M3 0h10a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2v-1h1v1a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H3a1 1 0 0 0-1 1v1H1V2a2 2 0 0 1 2-2z"></path>
        <path d="M1 5v-.5a.5.5 0 0 1 1 0V5h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1H1zm0 3v-.5a.5.5 0 0 1 1 0V8h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1H1zm0 3v-.5a.5.5 0 0 1 1 0v.5h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1H1z"></path>
      </svg>
      Обслуживание невозможно
    </a>
  </div>
</div>
{% endblock content %}